//
//  TRAsyncTestCase.m
//  Chowderios
//
//  Created by Pedro Gomes on 19/12/2013.
//  Copyright (c) 2013 Thomson Reuters Global Resources.  All Rights Reserved.  Proprietary and confidential information of TRGR.  Disclosure, use, or reproduction without written authorization of TRGR is prohibited. All rights reserved.
//

#import "TRAsyncTestCase.h"

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
@interface TRAsyncTestCase ()

@property (nonatomic, strong) NSMutableSet *expectedCallbacks;

@end

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
@implementation TRAsyncTestCase

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
- (void)setUp
{
    [super setUp];
    self.expectedCallbacks = [NSMutableSet set];
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
- (void)tearDown
{
    [super tearDown];
    self.expectedCallbacks = nil;
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
- (void)registerExpectedCallback:(id)callback
{
    [self.expectedCallbacks addObject:callback];
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
- (void)signalCallbackReceived:(id)callback
{
    if([self.expectedCallbacks containsObject:callback]) {
        [self.expectedCallbacks removeObject:callback];
        if(self.expectedCallbacks.count == 0) {
            [self notify:XCTAsyncTestCaseStatusSucceeded];
        }
    }
    else {
        [self notify:XCTAsyncTestCaseStatusFailed];
    }
}

@end
